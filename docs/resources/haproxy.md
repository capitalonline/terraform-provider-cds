---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "cds_haproxy Resource - terraform-provider-cds"
subcategory: ""
description: |-
  Haproxy instance.
---

# cds_haproxy (Resource)

Haproxy instance.

## Example usage

```hcl

resource cds_haproxy my_haproxy {
	region_id 		= "XXXXXXXX"

	vdc_id 		= "XXXXXXXX"
	base_pipe_id  = "XXXXXXXX"
	instance_name   = "ha_instance"
    # paas_goods_id 从data.json PaasGoodsId 获取
	cpu = 1
	ram = 2
	ips = [
		{
			# pipe_id is PrivateNetwork PrivateId from vdc info 
			pipe_id    = "xxx"
			pipe_type  = "private"
			segment_id = "xxx"
		},
		#This parameter is required if you want to create a public network(如创建公网，则需要)
		{
			# pipe_id is PublicNetwork PublicId from vdc info 
			pipe_id    = "xxx"
			pipe_type  = "public"
			segment_id = "xxx"
		}
	]
	http_listeners = [{
		server_timeout_unit = "s"
		server_timeout      = 1300
		sticky_session      = "on"
		acl_white_list      = "192.168.9.1"
		listener_mode       = "http"
		max_conn            = "2022"
		connect_timeout_unit = "s"
		scheduler           = "roundrobin"
		connect_timeout     = "1300"
		client_timeout      = "1022"
		listener_name       = "terraform"
		client_timeout_unit = "ms"
		listener_port       = 24354
		backend_server = [{
			ip       = "192.168.12.1"
			max_conn = 2022
			port     = 12314
			weight   = 255
		}]
		certificate_ids = []

#		The parameters option is a list,only one element at most
#		option = [{
#			httpchk = {
#				method = "GET"
#				uri = "/health"
#			}
#		}]
#		The parameters session_persistence is a list,only one element at most
#		session_persistence  = [
#			{
#				key = "test"
#				mode = 1
#				timer = {
#					max_idle=33
#					max_life=44
#				}
#			}
#		]
	}]
}

```



<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `base_pipe_id` (String) Base pipe id.
- `cpu` (Number) Instance cpu num.
- `instance_name` (String) Instance name.
- `ips` (Block List, Min: 1) The network used by HA. [View Document](https://github.com/capitalonline/openapi/blob/master/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A6%82%E8%A7%88.md#3createloadbalancer) (see [below for nested schema](#nestedblock--ips))
- `ram` (Number) Instance ram size.
- `region_id` (String) Regon id.
- `vdc_id` (String) Vdc id.

### Optional

- `http_listeners` (Block List) Http listeners. [View Document](https://github.com/capitalonline/openapi/blob/master/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A6%82%E8%A7%88.md#3createloadbalancer) (see [below for nested schema](#nestedblock--http_listeners))
- `subject_id` (Number) Subject ID.
- `tcp_listeners` (Block List) Tcp listeners.[View Document](https://github.com/capitalonline/openapi/blob/master/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A6%82%E8%A7%88.md#%E4%BF%AE%E6%94%B9%E7%AD%96%E7%95%A5tcplistenersobj) (see [below for nested schema](#nestedblock--tcp_listeners))

### Read-Only

- `id` (String) The ID of this resource.

<a id="nestedblock--ips"></a>
### Nested Schema for `ips`

Required:

- `pipe_id` (String) Pipe id. Internal network ID, or public network ID.
- `pipe_type` (String) Pipe type. Possible values: pipe_type、public.

Optional:

- `segment_id` (String) Segment id. The number of the occupied public network segment, which will occupy 3 public networks.


<a id="nestedblock--http_listeners"></a>
### Nested Schema for `http_listeners`

Required:

- `acl_white_list` (String) Acl white list. Set a whitelist, for example 192.168.12.1,192.168.1.1/20.

Optional:

- `backend_server` (Block List) Backend server. Backend server configuration. [View Document](https://github.com/capitalonline/openapi/blob/master/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A6%82%E8%A7%88.md#%E4%BF%AE%E6%94%B9%E7%AD%96%E7%95%A5BackendServerObj) (see [below for nested schema](#nestedblock--http_listeners--backend_server))
- `certificate_ids` (Block List) [View Document](https://github.com/capitalonline/openapi/blob/master/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A6%82%E8%A7%88.md#%E4%BF%AE%E6%94%B9%E7%AD%96%E7%95%A5certificateIdsobj) (see [below for nested schema](#nestedblock--http_listeners--certificate_ids))
- `client_timeout` (String) Client timeout. Set the timeout period for client connections.
- `client_timeout_unit` (String) Client timeout unit. Set the timeout period for request connections in units ["ms", "s"].
- `connect_timeout` (String) Connect timeout. Set the timeout period for request connections.
- `connect_timeout_unit` (String) Connect timeout unit. Set the timeout unit for request connections ["ms", "s"].
- `listener_mode` (String) Listener mode.
- `listener_name` (String) The name of the listening strategy.The character length is 1~50, starting with a letter and ending with a letter or number. It consists of lowercase letters, numbers, or underscores. The name must be unique.
- `listener_port` (Number) Listener port. Listening port for the strategy.The value range is 1-65535, with ports 22, 1080, 9100, and 9101 disabled.
- `max_conn` (Number) Max connection. Maximum number of connections for the proxy end.
- `option` (Block List) Option. [View Document](https://github.com/capitalonline/openapi/blob/master/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A6%82%E8%A7%88.md#%E4%BF%AE%E6%94%B9%E7%AD%96%E7%95%A5OptionObj) (see [below for nested schema](#nestedblock--http_listeners--option))
- `scheduler` (String) Scheduler. Scheduling algorithm ["roundrobin", "leastconn", "static-rr", "source"].
- `server_timeout` (String) Server timeout.
- `server_timeout_unit` (String) Server timeout unit. Set the server timeout unit ["ms", "s"].
- `session_persistence` (Block List, Max: 1) Session persistence. [View Document](https://github.com/capitalonline/openapi/blob/master/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A6%82%E8%A7%88.md#%E4%BF%AE%E6%94%B9%E7%AD%96%E7%95%A5SessionPersistenceObj) (see [below for nested schema](#nestedblock--http_listeners--session_persistence))
- `sticky_session` (String) Sticky session. Enable keep-alive for long connections ["on", "off"].

<a id="nestedblock--http_listeners--backend_server"></a>
### Nested Schema for `http_listeners.backend_server`

Required:

- `ip` (String) Ip. IP addresses of the backend servers (domain names are supported under the public network).
- `max_conn` (Number) Max connection. Maximum number of connections for the backend servers.
- `port` (Number) Port. Backend server port.
- `weight` (String) Weight. Backend server weight, with a range of 1-256.


<a id="nestedblock--http_listeners--certificate_ids"></a>
### Nested Schema for `http_listeners.certificate_ids`

Required:

- `certificate_id` (String) Certificate id.
- `certificate_name` (String) Certificate name.


<a id="nestedblock--http_listeners--option"></a>
### Nested Schema for `http_listeners.option`

Optional:

- `httpchk` (Map of String) Http check. Enable health checks for HTTP.


<a id="nestedblock--http_listeners--session_persistence"></a>
### Nested Schema for `http_listeners.session_persistence`

Optional:

- `key` (String) Key. Set the Cookie key value in the HTTP response. The character length is 2-15, starting with a letter and ending with a letter or number. It consists of lowercase letters, numbers, or underscores, and the key must be unique.
- `mode` (Number) Mode. The default value is 1.
0. Indicates that the content of the Cookie is retained in the cache (e.g., CDN).
1. Indicates that the content of the Cookie is not retained in the cache (e.g., CDN) and the cookie set by the load balancer is visible to the backend service.
2. Indicates that the content of the Cookie is not retained in the cache (e.g., CDN) and the cookie set by the load balancer is not visible to the backend service, i.e., in transparent mode, only the cookies set by the client are visible.
- `timer` (Map of String) Timer.Set the session persistence time parameter, unit: seconds. [View Document](https://github.com/capitalonline/openapi/blob/master/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A6%82%E8%A7%88.md#%E4%BF%AE%E6%94%B9%E7%AD%96%E7%95%A5TimerObj)



<a id="nestedblock--tcp_listeners"></a>
### Nested Schema for `tcp_listeners`

Optional:

- `acl_white_list` (String) Acl white list. Set whitelist, for example: ["129.12.12.1", "192.168.1.1/20"].
- `backend_server` (Block List) Backend server configuration. [View Document](https://github.com/capitalonline/openapi/blob/master/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A6%82%E8%A7%88.md#%E4%BF%AE%E6%94%B9%E7%AD%96%E7%95%A5BackendServerObj) (see [below for nested schema](#nestedblock--tcp_listeners--backend_server))
- `client_timeout` (String) Client timeout. Set the client connection timeout duration.
- `client_timeout_unit` (String) Client timeout unit. Set the unit of client connection timeout duration to ["ms", "s"].
- `connect_timeout` (String) Connect timeout. Set the request connection timeout duration.
- `connect_timeout_unit` (String) Connect timeout unit. Set the unit of request connection timeout duration to ["ms", "s"].
- `listener_mode` (String) Listener mode.
- `listener_name` (String) Listener name. The name of the listening strategy.  Character length: 1-50.  Starts with a letter, ends with a letter or number. Consists of lowercase letters, numbers, or underscores. The name must be unique.
- `listener_port` (Number) Listener port. Listening port for the strategy. Value range: 1-65535. Ports 22, 1080, 9100, and 9101 are disabled and not within the valid range.
- `max_conn` (Number) Max connection. Maximum number of connections for the proxy end.
- `scheduler` (String) Scheduler. Scheduling algorithm options include: ["roundrobin", "leastconn", "static-rr",  "source"].
- `server_timeout` (String) Server timeout. Set the server-side timeout duration.
- `server_timeout_unit` (String) Server timeout unit. Set the unit of server-side timeout duration to ["ms", "s"].

<a id="nestedblock--tcp_listeners--backend_server"></a>
### Nested Schema for `tcp_listeners.backend_server`

Required:

- `ip` (String) Ip. Backend server IP address (support domain names in public network).
- `max_conn` (Number) Max connection. Maximum number of connections for the backend server.
- `port` (Number) Backend server port.
- `weight` (String) Backend server weight, with a range of 1-256.
